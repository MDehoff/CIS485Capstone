import streamlit as st
import pandas as pd
import numpy as np
import streamlit.components.v1 as components

st.set_page_config(page_title="Pitcher Health Dashboard", layout="wide")

# Load external HTML
with open("index.html", "r") as file:
    html_content = file.read()

components.html(html_content, height=350)

st.markdown("---")

uploaded_file = st.file_uploader("Upload Pitching CSV", type=["csv"])

if uploaded_file is not None:
    df = pd.read_csv(uploaded_file)

    st.subheader("ğŸ“Š Averages")

    numeric_cols = [
        "velocity_mph",
        "spin_rate_rpm",
        "horiz_break_in",
        "vert_break_in",
        "release_height_ft",
        "release_side_ft",
        "release_consistency_score"
    ]

    averages = df[numeric_cols].mean()
    st.dataframe(averages)

    st.subheader("ğŸ“‰ Release Point Variability")

    release_height_std = df["release_height_ft"].std()
    release_side_std = df["release_side_ft"].std()

    st.write("Release Height Std Dev:", round(release_height_std, 3))
    st.write("Release Side Std Dev:", round(release_side_std, 3))

    st.subheader("âš ï¸ Health Risk Detection")

    velocity_drop = df["velocity_mph"].iloc[0] - df["velocity_mph"].iloc[-1]
    spin_drop = df["spin_rate_rpm"].iloc[0] - df["spin_rate_rpm"].iloc[-1]
    consistency_avg = df["release_consistency_score"].mean()

    if velocity_drop > 1.5:
        st.error("Velocity drop detected.")
    if spin_drop > 150:
        st.error("Spin rate drop detected.")
    if release_height_std > 0.15:
        st.error("Release height variability increasing.")
    if consistency_avg < 88:
        st.error("Low release consistency.")

    if (
        velocity_drop <= 1.5 and
        spin_drop <= 150 and
        release_height_std <= 0.15 and
        consistency_avg >= 88
    ):
        st.success("No major injury red flags detected.")

    st.subheader("ğŸ“ˆ Trends")

    st.line_chart(df["velocity_mph"])
    st.line_chart(df["spin_rate_rpm"])
    st.line_chart(df["release_height_ft"])
    st.line_chart(df["release_side_ft"])

else:
    st.info("Upload a CSV file to begin.")
