import streamlit as st
import pandas as pd
import numpy as np

st.set_page_config(page_title="Pitcher Health Dashboard", layout="wide")

st.title("âš¾ Pitcher Health & Performance Dashboard")

# ------------------------------------
# LOAD CSV FILE
# ------------------------------------

df = pd.read_csv("pitching_data.csv")

st.subheader("ğŸ“Š Raw Data")
st.dataframe(df)

# ------------------------------------
# AVERAGES
# ------------------------------------

st.subheader("ğŸ“ˆ Performance Averages")

numeric_cols = df.select_dtypes(include=np.number).columns
averages = df[numeric_cols].mean().round(2)

col1, col2, col3 = st.columns(3)

col1.metric("Avg Velocity (mph)", averages["velocity_mph"])
col2.metric("Avg Spin Rate (rpm)", averages["spin_rate_rpm"])
col3.metric("Avg Release Consistency", averages["release_consistency_score"])

# ------------------------------------
# RELEASE POINT STABILITY
# ------------------------------------

st.subheader("ğŸ“‰ Release Point Stability")

height_std = df["release_height_ft"].std()
side_std = df["release_side_ft"].std()

col4, col5 = st.columns(2)
col4.metric("Release Height Variability", round(height_std, 3))
col5.metric("Release Side Variability", round(side_std, 3))

# ------------------------------------
# TREND ANALYSIS
# ------------------------------------

velocity_drop = df["velocity_mph"].iloc[0] - df["velocity_mph"].iloc[-1]
spin_drop = df["spin_rate_rpm"].iloc[0] - df["spin_rate_rpm"].iloc[-1]

# ------------------------------------
# HEALTH SCORE
# ------------------------------------

st.subheader("ğŸ§  Injury Risk Assessment")

risk_score = 0

if velocity_drop > 1.5:
    st.warning("Velocity drop detected (>1.5 mph)")
    risk_score += 25

if spin_drop > 150:
    st.warning("Spin rate drop detected (>150 rpm)")
    risk_score += 25

if height_std > 0.15:
    st.warning("Release height variability elevated")
    risk_score += 25

if averages["release_consistency_score"] < 88:
    st.warning("Low release consistency")
    risk_score += 25

health_score = max(0, 100 - risk_score)

st.metric("Pitcher Health Score (0â€“100)", health_score)

if health_score >= 85:
    st.success("Low injury risk profile")
elif health_score >= 60:
    st.info("Moderate fatigue risk")
else:
    st.error("High injury risk")

# ------------------------------------
# VISUALS
# ------------------------------------

st.subheader("ğŸ“ˆ Performance Trends")

st.line_chart(df["velocity_mph"])
st.line_chart(df["spin_rate_rpm"])
st.line_chart(df["release_height_ft"])
st.line_chart(df["release_side_ft"])

# ------------------------------------
# HEALTH GUIDANCE
# ------------------------------------

st.subheader("ğŸ¥ Best Data for Keeping Pitchers Healthy")

st.markdown("""
### Most Important Metrics

1. **Release Point Variability** â€“ strongest early injury indicator  
2. **Velocity Trends** â€“ fatigue marker  
3. **Spin Rate Stability** â€“ elbow/forearm stress signal  
4. **Vertical Break Consistency** â€“ mechanical drift detection  
5. **Workload Volume** â€“ overuse predictor  

Tracking rolling averages over time provides the best injury prevention model.
""")
